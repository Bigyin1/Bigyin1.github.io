<!DOCTYPE html>
<html lang=" en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Об адресах в компьютере. Часть 1. | Home</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Об адресах в компьютере. Часть 1." />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="https://bigyin1.github.io//2021/09/25/Addresses.html" />
<meta property="og:url" content="https://bigyin1.github.io//2021/09/25/Addresses.html" />
<meta property="og:site_name" content="Home" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-09-25T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Об адресах в компьютере. Часть 1." />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-09-25T00:00:00+00:00","datePublished":"2021-09-25T00:00:00+00:00","headline":"Об адресах в компьютере. Часть 1.","mainEntityOfPage":{"@type":"WebPage","@id":"https://bigyin1.github.io//2021/09/25/Addresses.html"},"url":"https://bigyin1.github.io//2021/09/25/Addresses.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://bigyin1.github.io//feed.xml" title="Home" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Home</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">Обо Мне</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
    <div class="wrapper">
      <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Об адресах в компьютере. Часть 1.</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2021-09-25T00:00:00+00:00" itemprop="datePublished">Sep 25, 2021
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ol id="markdown-toc">
  <li><a href="#основные-идеи" id="markdown-toc-основные-идеи">Основные идеи</a></li>
  <li><a href="#взаимодействие-с-переферией" id="markdown-toc-взаимодействие-с-переферией">Взаимодействие с переферией</a></li>
  <li><a href="#немного-про-сам-процессор" id="markdown-toc-немного-про-сам-процессор">Немного про сам процессор</a></li>
</ol>

<p>Здесь Я постаряюсь подробно описать основные механизмы взаимодействия процессора и переферийных устройств, так как, на мой взгляд, эта тема плохо освещается в большинстве академических курсов.</p>

<h2 id="основные-идеи">Основные идеи</h2>

<p>Процессор, программы для которого мы в большинстве случаев пишем, является сложным электронным устройством, но сам по себе он умеет совсем немного:
исполнять свои инструкции и отправлять или считывать электрические сигналы со своих многочисленных контактов. Этого явно не достаточно для того чтобы такая система звалась компьютером. Как минимум требуется подключить память, иначе будет негде хранить данные и инструкции, а без них процессор не имеет смысла.</p>

<p>Но вот вопрос: как организовать подключение памяти и взаимодействие с ней? Для этого придумали невероятно простой и изящный механизм. Весь “внешний мир” процесса представляется ему как массив двоичных состояний - битов. Выше Я упомянул лишь память, но к процессору, как правило, подключаются много других устройств и красота такого механизма проявляется в абсолютной независимости процессора от типа подключаемого устройства. Все они(даже оперативная память, занимающая особое положение) представлены процессору как набор переключателей с двумя положениями. Ниже, я подробней расскажу об этом.</p>

<p>Чтобы иметь возможность взаимодействовать с конкретным битом требуется механизм их адресации.
Сам способ адресации весьма прост: индексирование от 0 до максимального адреса. Само же взаимодействие заключается в двух возможных действиях со стороны процессора: чтение состояния с адреса и запись по адресу. Подробнее об этом позже.</p>

<p>Я здесь про отдельные биты рассказываю, но как вы знаете, современные компьютеры оперируют группами сразу из нескольких бит. Такая группа называется Minimum Addressable Unit (MAU) и на сегодняшний день равна 8 битам, но так было далеко не всегда. <a href="https://en.wikipedia.org/wiki/Word_addressing">Здесь</a> и <a href="https://en.wikipedia.org/wiki/Byte_addressing">здесь</a> можно подробно прочитать об этом.
Массив всех MAU до которых способен дотянуться процессор называется физическим адресным пространством(почему оно физическое расскажу позже).
Используя 8 битный MAU, мы увеличиваем физическое адресное пространство в 8 раз при том же количестве адресов, в сравнении с использованием 1 бита в качестве MAU, но при этом усложняется и замедляется взаимодействие с отдельными битами. Это наиболее заметно при работе с массивами из boolean элементов. Синонимом MAU является <code class="language-plaintext highlighter-rouge">байт</code>. Есть разные версии того почему размер байта(MAU) в итоге выбрали именно в 8 бит. Наиболее вероятная - это широко используемая 8-битная кодировка <a href="https://en.wikipedia.org/wiki/Extended_ASCII">Extended ASCII</a>.</p>

<p>Само физическое адресное пространство формируется адресными контактами процессора(для отдельно взятого процессора, это просто набор контактов, не имеющих смысла при отсутствии подключенных устройств). Желая взаимодействовать с конкретным адресом, процессор выводит его с их помощью, а подключенные к этим контактам устройства, уже распознают свой адрес. Подробнее об этом я расскажу в следующей статье.</p>

<h2 id="взаимодействие-с-переферией">Взаимодействие с переферией</h2>

<p>Вернемся к переферийным устройствам. Хорошо, со стороны процессора мы имеем физическое адресное пространство, но как его “соединить” с внешними устройствами?
Здесь также был придуман весьма изящный способ: каждое переферийное устройство обладает набором тех самых переключателей - битов. За каждым из этих переключателей стоит некое реальное действие. Самое простое - это обычное сохранение последнего записанного состояния, как это делает RAM.</p>

<p>В электронике, устройство хранящее цифровую информацию называется <code class="language-plaintext highlighter-rouge">регистром</code>. Каждое переферийное устройство с которым взаимодействует процессор, имеет хотя бы один регистр с помощью которого они могут взаимодействовать(т.е обмениваться данными) с процессором. Регистры могут иметь разную разрядность, в зависости от контролируемой ими функции. Например, для светодиода необходимо и достаточно одного регистра разрядностью 1 бит. Именно регистры и занимают “места” в физическом адресном пространстве процессора.</p>

<p>Нужно вспомнить об вышеупомянутом MAU в 1 байт. Регистры непосредственно затронуты этой интересной особенностью и взаимодействовать с одним их битом за раз не получится: поэтому <code class="language-plaintext highlighter-rouge">регистры</code> имеют размер кратный 1-му байту(даже там где это избыточно). Как правило, регистр состоит из битов объединенных общим предназначением. Наиболее яркий пример это оперативная память, которая, по сути, является одним большим регистром данных (да, регистры вовсе не ограничены длиной в 8, 32 или 64 бита). В других переферийных устройствах, например таймерах, есть т.н конфигурационные регистры с помощью которых его можно настроить, запустить или остановить.</p>

<p>Представьте, все это похоже на то как мы взаимодействуем с различными механизмами. Например СВЧ печь: различные кнопки управления на ней это регистры конфигурации, а внутреннее отделение печи это, своего рода, регистр данных в который мы загружаем сырую еду. Еще пример - школьная доска, которая является логическим аналогом оперативной памяти, будучи одним большим регистром данных, сохраняющим последнее записанное значение.</p>

<p>Более подробно рассмотрим одно из самых простых и распространенных переферийных устройств - порт ввода-вывода общего назначения (GPIO)</p>

<p><img src="/assets/img/posts/addrs/addr_gpio.png" alt="GPIO" /></p>

<p>Он представляет из себя группу контактов на каждом из которых можно выводить логический уровень(0 или 1) или считывать его из вне. Для управления им необходимо 2 регистра: регистр данных(DR) и т.н Data Direction Register.
Каждый бит этих регистров управляет соответствующим контактом: бит в DDR задает режим работы контакта(1 если на вывод, 0 если на ввод), а бит в DR содержит текущий логический уровень выводимый нами(DDR=1) или вводимый из вне(DDR=0).
Вышеописанные регистры занимают свои места в физическом адресном пространстве нашего процессора. Теперь записи и чтения по этим адресам будут контролировать работу нашего устройства GPIO.</p>

<p>Давайте взглянем на происходящее несколько шире:</p>

<p><img src="/assets/img/posts/addrs/addr_space.png" alt="UML Addr Space" /></p>

<p>На вышепредставленной картинке в форме UML представлены(на сколько возможно) отношения между процессором, его физическим адресным пространством и переферией. Ключевой фигурой здесь является интерфейс Byte - как легко догадаться, он описывает интерфейс одного байта из адресного пространства. Адресное пространство, в таком случае, есть массив этих интерфейсов, а переферийные устройства реализуют некоторые интерфейсы из этого массива, то есть на места “виртуальных”, байтов встают реальные регистры. Здесь можно заметить одну интересную особенность: реализацию <code class="language-plaintext highlighter-rouge">принципа инверсии зависимостей</code> в отношении процессора и переферии, и все благодаря механизму адресного пространства. В результате ни процессор ни переферия не зависят друг от друга, что дает свободу манёвра в плане различных взаимодействий между ними.</p>

<h2 id="немного-про-сам-процессор">Немного про сам процессор</h2>
<p>В Intel® 64 and IA-32 Architectures Software Developer’s Manual есть интересная схема, демонстрирующая то чем процессор предстаёт для исполняемой им программы:</p>

<p><img src="/assets/img/posts/addrs/EE.png" alt="EE" width="400" height="589" /></p>

<p>Что не удивительно, здесь опять все заполнено знакомыми нам регистрами, а в правом верхнем углу…(ну вы поняли).
Регистры процессора служат тем же целям, что и в переферийных устройствах - формируют его интерфейс. Отличие состоит в том, что процессор, очевидно, хорошо осведомлен о своём внутреннем устройстве и, поэтому, побайтовая адресация не требуется, адресовать его регистры можно целиком(т.е каждый адрес соответсвует целому регистру процессора, а не байту). Можно сказать, что совокупный набор регистров процессора составляет, своего рода, отдельное адресное пространство.</p>

  </div><a class="u-url" href="/2021/09/25/Addresses.html" hidden></a>
</article>

    </div>
  </main><footer class="site-footer h-card">
  <data class="u-url" href="/%20/"></data>

  <div class="wrapper">

    <h2 class="footer-heading"></h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name"></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/Bigyin1"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">Bigyin1</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>

<script src='https://polyfill.io/v3/polyfill.min.js?features=es6'></script>
<script id=”MathJax-script” async src='https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'></script>