---
title: Об адресах
date: 2021-09-25
render_with_liquid: false
---


Эта статья скорее является сборником вопросов.

## Basic concepts


Процессор, программы для которого мы в большинстве случаев пишем, является сложным электронным устройством, но сам по себе он умеет совсем немного:
исполнять свои инструкции и отправлять или считывать электрические сигналы со своих многочисленных контактов. Этого явно не достаточно для того чтобы такая система звалась компьютером. Как минумум требуется подключить память, иначе будет негде хранить данные и инстркукции, а без них процессор не имеет смысла. Кстати, предтеча компьютера - калькулятор, тем от него и отличается - он не умеет самостоятельно считывать инструкции и данные, роль, своего рода,  памяти для него исполняет человек-оператор.

Но вот вопрос: как организовать подключение памяти и взаимодействие с ней? Для этого придумали неверятно простой и изящный механизм. Весь "внешний мир" процесса представляется ему как массив двоичных состояний - битов. Выше Я упомянул лишь память, но к процессору, как правило, подключаются много других устройств и красота такого механизма проявляется в абсолютной незавсимости процессора от типа подключаемого устройства. Все они(даже оперативная память, занимающая особое положение) представлены процессору как набор переключателей с двумя положениями. Ниже, я подробней расскажу об этом.

Чтобы иметь возможность взаимодействовать с конкретным битом требуется механизм их адресации.
Сам способ адресации весьма прост: индексирование от 0 до максимального адреса. Само же взаимодействие заключается в двух возможных действиях со стороны процессора: чтение состояния с адреса и запись по адресу. Подробнее об этом позже.

Я здесь все про отдельные биты рассказываю, но как вы знаете, современные компьютеры оперируют группами сразу из нескольких бит. Такая группа называется Minimum Addressable Unit (MAU) и на сегодняшний день равна 8 битам, но так было далеко не всегда. [Здесь](https://en.wikipedia.org/wiki/Word_addressing) и [здесь](https://en.wikipedia.org/wiki/Byte_addressing) можно подробно прочитать об этом.
Массив всех MAU (далее байтов) до которых способен дотянуться процессор называется физическим адресным пространством(почему оно физическое расскажу позже).
Используя 8 битный MAU, мы увеличиваем физическое адресное пространство в 8 раз при том же количестве адресов, в сравнении с использованием 1 бита в качестве MAU, но при этом усложняется и замедляется взаимодействие с отдельными битами. Это наиболее заметно при работе с массивами из boolean элементов.

Само физическое адресное пространство формируется адресными контактами процессора(для отдельно взятого процессора, это просто набор проводков, не имеющих смысла при отстутсвии подключенных устройств). Желая взимодействовать с конкретным адресом, процессор выводит его с их помощью. Подробнее об этом позже.

## Communicating with Peripherals

Вернемся к переферийным устройствам. Хорошо, со стороны процессора мы имеем физическое адресное пространство, но как его "соединить" с внешним устройствами?
Здесь также был придуман весьма изящный способ: каждое переферийное устройство обладает набором тех самых переключателей - битов. За каждым из этих переключателей стоит некое реальное действие. Самое простое - это обычное сохранение последнего записанного состояния как это делет RAM.

Часто бывает так, что 1 бита не достаточно для представления какой либо функции устройства. Также нужно вспомнить об вышеупомянутом MAU в 1 байт. Переферийные устройства непосредственно затронуты этой интересной особенностью и взаимодействовать с одним их битом за раз не получится: поэтому биты, объединяют в так называемые `регистры`, размер которых кратен 1-му байту. Как правило, регистр состоит из битов объединенных общим предназначением. Наиболее яркий пример это оперативная память, которая, по сути, является одним большим регистром данных (да, регистры вовсе не ограничены длиной в 32 или 64 бита). В других переферийных устройствах, например таймерах, есть конфигурационные регистры с помошью которых его можно настроить, запустить, остановить.

Представьте, все похоже на то как мы взаимодействуем с различными механизмами. Например свч печь: различные кнопки управления на ней это регистры конфигурации, а внутреннее отделение печи это, своего рода, регистр данных в который мы загружаем сырую еду. Еще пример - школьная доска, которя является логическим аналогом оперативной памяти, будучи одним большим регистром данных, сохраняющим последнее записанное значение.

Рассмотрим пример: одно из самых простых переферийных устройств - порт ввода-вывода общего назначения (GPIO)

![GPIO](/assets/img/posts/addr_gpio.png)


## Еще про адресное пространство и немного про сам процессор

В Intel® 64 and IA-32 Architectures Software Developer’s Manual






Сначала - небольшое размышление на тему Людей и Компьютеров. Мы, люди, воспринимаем окружающую нас информацию в виде конкретных образов - будь то числа, текст, изображения и даже действия(котрые тоже являются своего рода информацией). Как это все в действительности работает "под капотом" в нашем мозге, наверное, еще долго будет являться загадкой. В случае с компьютерами ситуация несколько прозрачнее, хотя бы потому что они спроектированы людьми.